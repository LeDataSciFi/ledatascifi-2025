
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Classification Models &#8212; LeDataSciFi-2025</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/moviescript.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/frontpage.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fin377_specialformatting.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">LeDataSciFi-2025</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Syllabus
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/about/objectives.html">
   Objectives - Spring 2025 (NOT fall)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/about/outcomes.html">
   Outcomes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/about/use_of_gpt.html">
   ChatGPT and other AI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/about/interest.html">
   Interested but unsure?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/about/hall_of_awesomeness.html">
   The Hall of Awesomeness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/about/acknowledgments.html">
   Gratitude
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Tips and resources
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/about/help.html">
   Help
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/about/resources.html">
   Resources
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/about/tips.html">
   Tips and hacks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../content/slides/memes.html">
   Memes
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Textbook
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/01/00_Getting_Started.html">
   1. Motivation and Getting Started
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/01_Motivation.html">
     1.1. Motivation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/02_Setup.html">
     1.2. Set up - Spring 2025 (NOT fall 2025)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/03_github.html">
     1.3. GitHub Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/03a_githubworkflow.html">
     1.4. The GitHub Workflow
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/04_Markdown.html">
     1.5. Markdown basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/05_jupyterlab.html">
     1.6. Jupyter Lab Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/06_python.html">
     1.7. Python Basics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/07_debugging.html">
     1.8. Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/07a_errors.html">
     1.9. Errors
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/08_libraries.html">
     1.10. Libraries/Packages
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/01/09_gitignore.html">
     1.11. Gitignore Files
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/02/10_Golden_1.html">
   2. Good Analysis Practices
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/02/10_Golden_2.html">
     2.1. A case study of bad research
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/02/10_Golden_3.html">
     2.2. The golden rules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/02/10_Golden_6.html">
     2.3. Organizing your projects
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/02/10_Golden_7.html">
     2.4. Filepaths
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/02/10_Golden_4.html">
     2.5. Storing data smartly
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/02/10_Golden_5a.html">
     2.6. Functions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/02/10_Golden_5b.html">
     2.7. Writing good code comments
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/02/10_Golden_8.html">
     2.8. Writing good code
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/03/00_Data_Wrangling_Intro.html">
   3. Wrangling with Data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/03/01_Numpy.html">
     3.1. Numpy
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/01a_NumpyCS.html">
       3.1.1. Numpy + Scientific Computing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/01b_NumpyBasics.html">
       3.1.2. A (Very) Short Introduction
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/01c_NumpyPractice.html">
       3.1.3. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/01d_NumpyResources.html">
       3.1.4. More Resources
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/03/02a_pandasIntro.html">
     3.2. Pandas
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/02a_pandasTips.html">
       3.2.1. Tips
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/02b_pandasVocab.html">
       3.2.2. Vocab and Long vs Wide Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/02c_commonFcns.html">
       3.2.3. Common Functions
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/02d_temp.html">
       3.2.4. Temp. vs Perm. Objects
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/02e_eda_golden.html">
       3.2.5. Golden Rules + EDA
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/02f_chains.html">
       3.2.6. Pandas Chains
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/02g_commontasks.html">
       3.2.7. Common Tasks
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/02h_exercises.html">
       3.2.8. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/02j_resourcesAndSum.html">
       3.2.9. Summary and Resources
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/03/04a-dataviz.html">
     3.3. Data Visualization
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04b-whyplot.html">
       3.3.1. The Role of Viz in Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04c-makeplot.html">
       3.3.2. Making a Plot
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04d-whichplot.html">
       3.3.3. Which Plot Type Should I Use?
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04e-visualEDA.html">
       3.3.4. Visual EDA Walkthrough
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04e2-visualEDA-tools.html">
       3.3.5. Visual EDA Tools
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04e3-binscatter.html">
       3.3.6. Bin Scatter Plots
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04e4-binscatterGrids.html">
       3.3.7. Bin Scatter + Pair Plots
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04f1-viz_narrative.html">
       3.3.8. Better Plots
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04f2-customizing_figs.html">
       3.3.9. Customizing figures
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04f3-interactive_figs.html">
       3.3.10. Interactive plots:
       <code class="docutils literal notranslate">
        <span class="pre">
         plotly
        </span>
       </code>
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04f4-exercises.html">
       3.3.11. Exercises
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/04h_Summary.html">
       3.3.12. Chapter Summary
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/03/05a-otherskills.html">
     3.4. Other (Important) Data Wrangling Skills
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/05b_merging.html">
       3.4.1. Merging
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/05c_missingdata.html">
       3.4.2. Dealing with Missing Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/05d_outliers.html">
       3.4.3. Dealing with Outliers
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/03/05e_summary.html">
       3.4.4. Chapter Summary
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/04/00_World_Wide_Data.html">
   4. Building and Using Large (Textual) Data
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/04/01_Intro_to_scraping.html">
     4.1. Getting Data off the Web
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/04/01a_openingAndParsing.html">
     4.2. Opening + Parsing
     <em>
      a
     </em>
     Webpage
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/04/01b_spiders.html">
     4.3. Building a spider
    </a>
   </li>
   <li class="toctree-l2 collapsible-parent">
    <a class="reference internal" href="../../content/04/02_strings.html">
     4.4. Exploiting Textual Data
    </a>
    <ul class="collapse-ul">
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/04/02a_Python%20Strings.html">
       4.4.1. Working with Python Strings
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/04/02b_regex.html">
       4.4.2. Regex basics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/04/02c_developing_a_regex.html">
       4.4.3. Developing a regex
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../content/04/02d_RegexApplication.html">
       4.4.4. Intro to NLP - The Anchor Phase Technique
      </a>
     </li>
    </ul>
    <i class="fas fa-chevron-down">
    </i>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/05/00_intro.html">
   5. Data Science Intro
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/01_bigpicture.html">
     5.1. The promise of ML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/01b_model_process.html">
     5.2. Planning a project
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/01a_MLgonewrong.html">
     5.3. ML Gone Wrong
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/01c_teams.html">
     5.4. Coding in Teams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/01d_sharingBigFiles.html">
     5.5. Sharing large files
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/05/02_reg.html">
   6. Regression
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/02a_basics.html">
     6.1. Basics and Notation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/02b_mechanics.html">
     6.2. Mechanics of running regressions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/02c_goodnessOfFit.html">
     6.3. Goodness of Fit
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/02d_interpretingCoefs.html">
     6.4. Interpreting regression coefficients
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/02e_statisticalSig.html">
     6.5. Statistical significance
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/02f_warnings.html">
     6.6.
     <em>
      Significant
     </em>
     warnings about “statistical significance”
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/02h_summary_colFE.html">
     6.7. Fixed effects, categorical variables, and prettier regression tables
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/02g_summary.html">
     6.8. Summary and Resources
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/05/03_ML.html">
   7. ML - Intro &amp; Discussion
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/03a_ML_obj_and_tradeoff.html">
     7.1. The objective of machine learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/03f_leakage.html">
     7.2. Data Leakage - Illustration
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/03f_leakage3.html">
     7.3. Data Leakage - Illustration 2
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/03f_leakage2.html">
     7.4. Data Leakage Defined
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/03c_ModelEval.html">
     7.5. Model evaluation via cross validation (CV)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/03c1_OOS.html">
     7.6. Model evaluation via Out-of-Sample (OOS)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/03d_whatToMax.html">
     7.7. Evaluating models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/03e_whichModel.html">
     7.8. Model selection
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/05/04a_SKLearn.html">
   8. ML - Code &amp; Implementation
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/04b_best_practices.html">
     8.1. Best Practice Pseudo Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/04c_onemodel.html">
     8.2. SKLearn Intro
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/04d_crossval.html">
     8.3. Cross-Validation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/04e_pipelines.html">
     8.4. Pipelines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/04e1_preprocessing.html">
     8.5. Preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/04f_optimizing_a_model.html">
     8.6. Optimizing a Model
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/04h_putting_together.html">
     8.7. Many Models
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/05/05a_finapps.html">
   9. Finance Applications
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/05a_compounding.html">
     9.1. Compounding returns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/05a_rolling.html">
     9.2. Rolling returns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/05a_expanding.html">
     9.3. Expanding returns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/05b_capm.html">
     9.4. Estimating CAPM
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/05c_factorloadings.html">
     9.5. Estimating better models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/05d_AssetPricingAnomalyTable1.html">
     9.6. Does this signal make a tradeable anomaly?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/05e_OpenAP_anomaly_plot.html">
     9.7. Open Asset Pricing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/05f_MLtrading.html">
     9.8. Trading on stock return predictions
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/05c_finpacks.html">
     9.9. Supercharged resources/packages
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../../content/05/06_thefuture.html">
   10. The Future
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/06a_saving.html">
     10.1. Saving Your Work
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/06b_nextsteps.html">
     10.2. Faster, better, stronger
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../content/05/06c_dashboards.html">
     10.3. Dashboards
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/handouts/ML/ML_worksheet2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2025"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/LeDataSciFi/ledatascifi-2025/issues/new?title=Issue%20on%20page%20%2Fhandouts/ML/ML_worksheet2.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/LeDataSciFi/ledatascifi-2025/edit/main/handouts/ML/ML_worksheet2.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/LeDataSciFi/ledatascifi-2025/main?urlpath=lab/tree/handouts/ML/ML_worksheet2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/LeDataSciFi/ledatascifi-2025/blob/main/handouts/ML/ML_worksheet2.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#in-this-worksheet">
   In this worksheet:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-data">
   Load data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-the-training-and-holdout-samples">
   Create the training and holdout samples
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-one-classification-model">
   Setting up
   <em>
    one
   </em>
   classification model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluating-the-classification-model">
   Evaluating the classification model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calibration-display">
     Calibration display
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#classification-report">
     Classification Report
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confusion-matrix">
     Confusion Matrix
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decision-functions">
     “Decision functions”
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#precision-recall-curves">
     Precision-Recall Curves
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#roc-curve-receiver-operating-characteristic">
     ROC curve (“receiver operating characteristic”)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-problem-with-our-estimator-imbalance">
   The problem with our estimator: Imbalance
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#options-to-deal-with-imbalanced-data">
   Options to deal with imbalanced data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practical-tips">
     🔥🔥🔥 Practical tips: 🔥🔥🔥
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#changing-the-threshold-manually">
     Changing the threshold manually
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#weighting-example">
     Weighting example
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recap-before-exercises">
   Recap before exercises:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises-1-5-this-is-just-business-math">
   Exercises 1-5: This is just business math!
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises-6-and-7-now-we-think-about-reflecting-our-biz-logic-in-code">
   Exercises 6 and 7: Now we think about reflecting our biz logic in code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bonus-demo-undersampling">
   Bonus demo: Undersampling
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="classification-models">
<h1>Classification Models<a class="headerlink" href="#classification-models" title="Permalink to this headline">¶</a></h1>
<p><em>This “worksheet” is mostly textbook/walkthrough content. The exercises are at the end but rely on the proceeding material.</em></p>
<p>A <strong>classification model</strong> is when you’re predicting an outcome with discrete levels. It can be binary (default vs paid off), or multinomial (red, orange, yellow, green, blue, indigo, violet).</p>
<p><a class="reference external" href="https://scikit-learn.org/stable/modules/classification_threshold.html">Classification is best divided into two parts:</a></p>
<ol class="simple">
<li><p>the statistical problem of learning a model to predict, ideally, class probabilities;</p></li>
<li><p>the decision problem to take concrete action based on those probability predictions.</p></li>
</ol>
<p>We actually estimated a classification model in the last worksheet: Did borrowers pay back a loan?</p>
<p>We did this by estimating a logitistic (logit) regression.</p>
<p>A fitted logit model produces, for a given vector of data X, the predicted probability that y=1 for those values of X.</p>
<p>This is not a classification, its a probability, a number in [0,1].</p>
<p>A <em>classification model that uses logit</em> takes the logit predicted probability, and outputs a prediction: YES, or NO.</p>
<p>It does this by setting a <strong>threshold</strong> T: If the predicted probability is above T, then the prediction is YES.</p>
<div class="section" id="in-this-worksheet">
<h2>In this worksheet:<a class="headerlink" href="#in-this-worksheet" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>[ ] Ways to evaluate classifications models</p>
<ul>
<li><p>You can output a classification report and key diagnostics</p></li>
<li><p>You can use and interpret those outputs</p></li>
</ul>
</li>
<li><p>[ ] The problem of imbalanced data</p></li>
<li><p>[ ] Thinking about the objective: what to maximize and/or minimize in your model</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">df_after_transform</span><span class="w"> </span><span class="kn">import</span> <span class="n">df_after_transform</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_config</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.calibration</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalibrationDisplay</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.compose</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ColumnTransformer</span><span class="p">,</span>
    <span class="n">make_column_selector</span><span class="p">,</span>
    <span class="n">make_column_transformer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.impute</span><span class="w"> </span><span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ConfusionMatrixDisplay</span><span class="p">,</span>
    <span class="n">DetCurveDisplay</span><span class="p">,</span>
    <span class="n">PrecisionRecallDisplay</span><span class="p">,</span>
    <span class="n">RocCurveDisplay</span><span class="p">,</span>
    <span class="n">classification_report</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">GridSearchCV</span><span class="p">,</span>
    <span class="n">KFold</span><span class="p">,</span>
    <span class="n">cross_validate</span><span class="p">,</span>
    <span class="n">train_test_split</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.pipeline</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>

<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>  <span class="c1"># display=&#39;text&#39; is the default</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span>
    <span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;display.max_rows&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;display.max_columns&quot;</span><span class="p">,</span> <span class="kc">None</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-data">
<h2>Load data<a class="headerlink" href="#load-data" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loans</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;inputs/2013_subsample.zip&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-the-training-and-holdout-samples">
<h2>Create the training and holdout samples<a class="headerlink" href="#create-the-training-and-holdout-samples" title="Permalink to this headline">¶</a></h2>
<p>Here, we will use <code class="docutils literal notranslate"><span class="pre">test_train_split</span></code>, though this might not</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first let&#39;s separate y from X (as is typically done)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">loans</span><span class="o">.</span><span class="n">loan_status</span> <span class="o">==</span> <span class="s2">&quot;Charged Off&quot;</span>
<span class="n">y</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">loans</span> <span class="o">=</span> <span class="n">loans</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># stratify will make sure that test/train both have equal fractions of outcome</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">loans</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="setting-up-one-classification-model">
<h2>Setting up <em>one</em> classification model<a class="headerlink" href="#setting-up-one-classification-model" title="Permalink to this headline">¶</a></h2>
<p><em>Note: <code class="docutils literal notranslate"><span class="pre">preproc_pipe</span></code> is the exact same as last time, but I’ve defined it in a different (easier?) way, and I’ve named the whole pipeline <code class="docutils literal notranslate"><span class="pre">clf_logit</span></code></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up pipeline to clean each type of variable (1 pipe per var type)</span>

<span class="n">numer_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">),</span> <span class="n">StandardScaler</span><span class="p">())</span>

<span class="n">cat_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="s2">&quot;first&quot;</span><span class="p">))</span>

<span class="c1"># combine those (make_column_transformer is like make_pipeline, maybe easier on the eyes!)</span>

<span class="n">preproc_pipe</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">numer_pipe</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;annual_inc&quot;</span><span class="p">,</span> <span class="s2">&quot;int_rate&quot;</span><span class="p">]),</span>
    <span class="p">(</span><span class="n">cat_pipe</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;grade&quot;</span><span class="p">]),</span>
    <span class="n">remainder</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># estimator</span>

<span class="n">clf_logit</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preproc_pipe</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>I’m going to fit it to the whole training dataset. This means what we’re about to learn is being done without CV for now, and will likely result in overconfident performance metrics.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_logit</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer()),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]),
                                                 (&#x27;pipeline-2&#x27;,
                                                  Pipeline(steps=[(&#x27;onehotencoder&#x27;,
                                                                   OneHotEncoder(drop=&#x27;first&#x27;))]),
                                                  [&#x27;grade&#x27;])])),
                (&#x27;logisticregression&#x27;, LogisticRegression())])</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" ><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>Pipeline</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.pipeline.Pipeline.html">?<span>Documentation for Pipeline</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Pipeline(steps=[(&#x27;columntransformer&#x27;,
                 ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                                  Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                                   SimpleImputer()),
                                                                  (&#x27;standardscaler&#x27;,
                                                                   StandardScaler())]),
                                                  [&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]),
                                                 (&#x27;pipeline-2&#x27;,
                                                  Pipeline(steps=[(&#x27;onehotencoder&#x27;,
                                                                   OneHotEncoder(drop=&#x27;first&#x27;))]),
                                                  [&#x27;grade&#x27;])])),
                (&#x27;logisticregression&#x27;, LogisticRegression())])</pre></div> </div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" ><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>columntransformer: ColumnTransformer</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.compose.ColumnTransformer.html">?<span>Documentation for columntransformer: ColumnTransformer</span></a></div></label><div class="sk-toggleable__content fitted"><pre>ColumnTransformer(transformers=[(&#x27;pipeline-1&#x27;,
                                 Pipeline(steps=[(&#x27;simpleimputer&#x27;,
                                                  SimpleImputer()),
                                                 (&#x27;standardscaler&#x27;,
                                                  StandardScaler())]),
                                 [&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]),
                                (&#x27;pipeline-2&#x27;,
                                 Pipeline(steps=[(&#x27;onehotencoder&#x27;,
                                                  OneHotEncoder(drop=&#x27;first&#x27;))]),
                                 [&#x27;grade&#x27;])])</pre></div> </div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>pipeline-1</div></div></label><div class="sk-toggleable__content fitted"><pre>[&#x27;annual_inc&#x27;, &#x27;int_rate&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>SimpleImputer</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.impute.SimpleImputer.html">?<span>Documentation for SimpleImputer</span></a></div></label><div class="sk-toggleable__content fitted"><pre>SimpleImputer()</pre></div> </div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>StandardScaler</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.StandardScaler.html">?<span>Documentation for StandardScaler</span></a></div></label><div class="sk-toggleable__content fitted"><pre>StandardScaler()</pre></div> </div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-6" type="checkbox" ><label for="sk-estimator-id-6" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>pipeline-2</div></div></label><div class="sk-toggleable__content fitted"><pre>[&#x27;grade&#x27;]</pre></div> </div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-7" type="checkbox" ><label for="sk-estimator-id-7" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>OneHotEncoder</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.preprocessing.OneHotEncoder.html">?<span>Documentation for OneHotEncoder</span></a></div></label><div class="sk-toggleable__content fitted"><pre>OneHotEncoder(drop=&#x27;first&#x27;)</pre></div> </div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-8" type="checkbox" ><label for="sk-estimator-id-8" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LogisticRegression</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a></div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression()</pre></div> </div></div></div></div></div></div></div></div>
</div>
</div>
<div class="section" id="evaluating-the-classification-model">
<h2>Evaluating the classification model<a class="headerlink" href="#evaluating-the-classification-model" title="Permalink to this headline">¶</a></h2>
<p>First, we cover the classic “ML” model evaluation outputs. These aren’t made for business settings, but are useful.</p>
<ol class="simple">
<li><p>Calibration Display: Is your model producing well-tuned probabilities?</p></li>
<li><p>Classification report</p></li>
<li><p>Confusion Matrix</p></li>
<li><p>Precision-Recall Curve: Can your model have high recall and precision if we adjust the threshold?</p></li>
<li><p>ROC Curve: Can your model have low false positives and high recall if we adjust the threshold?</p></li>
</ol>
<div class="section" id="calibration-display">
<h3>Calibration display<a class="headerlink" href="#calibration-display" title="Permalink to this headline">¶</a></h3>
<p>Our logit estimator produces, for each loan, a prediction of the probability of default. A calibration display groups those predictions into buckets (on the x-axis), and reports the average true outcomes for that bucket (on the y-axis). A perfectly calibrated classifier will be on the 45 degree line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CalibrationDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sklearn.calibration.CalibrationDisplay at 0x277595d06d0&gt;
</pre></div>
</div>
<img alt="../../_images/ML_worksheet2_12_1.png" src="../../_images/ML_worksheet2_12_1.png" />
</div>
</div>
<p>This figure suggests that our logit seems to be decently “calibrated”.</p>
<p>This means the <em>estimation model</em> is decent, and that the <em>classifier</em> <em>can</em> be good.</p>
<p>This does not mean the classifier is good.</p>
</div>
<div class="section" id="classification-report">
<h3>Classification Report<a class="headerlink" href="#classification-report" title="Permalink to this headline">¶</a></h3>
<p><strong>When you build a classifier, you should always output a <code class="docutils literal notranslate"><span class="pre">classification_report</span></code>.</strong></p>
<p><em>Ignore the Warnings. This table is correct. It’s just mad that our model is so bad we never predict a default!</em></p>
<p>The definition of precision and recall and f1-score <a class="reference external" href="https://ledatascifi.github.io/ledatascifi-2022/content/05/03d_whatToMax.html">are here.</a></p>
<p>First I explain the terms abstractly, and after the table, I’ll rephase them in more direct language.</p>
<ul class="simple">
<li><p>Precision measures: When we predict an outcome, how often does that happen? (Are the predictions precise?)</p></li>
<li><p>Recall: What fraction of an outcome’s occurrences does your model detect? (“Does the model recall the true occurrences?”)</p>
<ul>
<li><p>Aka sensitivity: A sensitive model detects an outcome happening more often</p></li>
</ul>
</li>
<li><p>Accuracy: Fraction of labels that are correct across all observations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">macro_avg</span></code>: Simple average of the stats above the blank line.</p>
<ul>
<li><p>The average of the precision in the False and True observations here (0.84 and 0) is 0.42</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">weighted_avg</span></code>: Average of the stats above the blank line, weighted by the number of observations in each outcome type</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> 
                            <span class="n">clf_logit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              precision    recall  f1-score   support

       False       0.84      1.00      0.92     91024
        True       0.00      0.00      0.00     16819

    accuracy                           0.84    107843
   macro avg       0.42      0.50      0.46    107843
weighted avg       0.71      0.84      0.77    107843
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\DonsLaptop\anaconda3\Lib\site-packages\sklearn\metrics\_classification.py:1565: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f&quot;{metric.capitalize()} is&quot;, len(result))
c:\Users\DonsLaptop\anaconda3\Lib\site-packages\sklearn\metrics\_classification.py:1565: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f&quot;{metric.capitalize()} is&quot;, len(result))
c:\Users\DonsLaptop\anaconda3\Lib\site-packages\sklearn\metrics\_classification.py:1565: UndefinedMetricWarning: Precision is ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, f&quot;{metric.capitalize()} is&quot;, len(result))
</pre></div>
</div>
</div>
</div>
<p>Above: We get Precision and Recall for each class. Let’s translate those metrics into business words:</p>
<ul class="simple">
<li><p>False (paid back) precision: When our model predicts a loan will be paid back, how many actually were? (84%)</p></li>
<li><p>True (charge off) precision: When our model predicts a loan will be charged off, how many actually were? (0%)</p></li>
<li><p>False (paid back) recall: What fraction of the paid off loans does our model predict would be? (100%)</p></li>
<li><p>True (charge off) recall: What fraction of the charged off loans does our model predict would be? (0%)</p></li>
</ul>
</div>
<div class="section" id="confusion-matrix">
<h3>Confusion Matrix<a class="headerlink" href="#confusion-matrix" title="Permalink to this headline">¶</a></h3>
<p><strong>You should also output a Confusion Matrix, which is a standard way to display how a classifier is doing.</strong></p>
<ul class="simple">
<li><p>If you add <code class="docutils literal notranslate"><span class="pre">normalize='pred'</span></code> to the function below, the diagonal elements are your precisions.</p></li>
<li><p>If you add <code class="docutils literal notranslate"><span class="pre">normalize='true'</span></code> to the function below, the diagonal elements are your recalls.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">display_labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Paid Back&quot;</span><span class="p">,</span> <span class="s2">&quot;Default&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model 1: Logit with Default Parameters&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ML_worksheet2_18_0.png" src="../../_images/ML_worksheet2_18_0.png" />
</div>
</div>
<p>So even though our logit seems to be decently calibrated, it is performing AWFULLY in terms of precision and recall on predicting defaults, because it never predict a default.</p>
<p>What gives?</p>
</div>
<div class="section" id="decision-functions">
<h3>“Decision functions”<a class="headerlink" href="#decision-functions" title="Permalink to this headline">¶</a></h3>
<p>Here’s what happens:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">blah</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">==============================================================================</span>
<span class="s1">          A flow chart from our model to the final predictions:</span>
<span class="s1">==============================================================================</span>

<span class="s1">logit     &gt;      ahat,           &gt;             yhat           &gt;         {0,1}</span>
<span class="s1">                 bhat                        Pr(y=1|X)</span>
<span class="s1">      ----------        --------------------           --------------</span>
<span class="s1">      | .fit() |        | .predict_proba() |           | .predict() |</span>
<span class="s1">      |        |        |  uses ahat bhat  |           |   uses  ?  |</span>
<span class="s1">      ----------        --------------------           --------------</span>

<span class="s1">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>That last step, <code class="docutils literal notranslate"><span class="pre">.predict()</span></code> uses a <strong>“decision function”</strong> that turns the yhat values (predicted probabilities) into predictions.</p>
<p>The <strong>“default threshold”</strong> in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> for logit is 0.5:</p>
<ul class="simple">
<li><p>If yhat&gt;0.5: predict outcome = 1</p></li>
<li><p>Else: predict outcome = 0</p></li>
</ul>
<p><strong>You don’t need to use the default threshold! The threshold is a choice a researcher needs to make, as it involves important tradeoffs.</strong></p>
<p>In practice, how you make the choice depends on whether your business problem has larger costs for false positives, false negative, or larger benefits for true positives and true negatives.</p>
<p>The next set of diagnostics help you see how changing the threshold can change the performance of the model and assess these tradeoffs.</p>
</div>
<div class="section" id="precision-recall-curves">
<h3>Precision-Recall Curves<a class="headerlink" href="#precision-recall-curves" title="Permalink to this headline">¶</a></h3>
<p>This takes all the predicted probabilities the model produces, and pretends we set a threshold of 0.01, 0.02, … 0.99. For each possible threshold, compute the <strong>precision and recall</strong> of the predictions, and then plot them all.</p>
<p>Sklearn has a function to do this all at once, which I’ll show next, but I want to show you how it’s being made under the hood to highlight what the figure shows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the predicted probabilities for the positive class</span>
<span class="n">y_prob</span> <span class="o">=</span> <span class="n">clf_logit</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Calculate precision and recall values at different thresholds</span>
<span class="n">thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">precision</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">recall</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>

    <span class="c1"># At this threshold, if the model&#39;s predicted probability</span>
    <span class="c1"># is greater than the threshold, classify as positive</span>
    <span class="n">y_pred_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_prob</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)</span> 
    
    <span class="c1"># Calculate precision and recall</span>
    <span class="c1"># precision_val = true positives / predicted_true</span>
    <span class="c1"># recall_val = true positives / actually_true</span>

    <span class="n">tp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_train</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_pred_threshold</span> <span class="o">==</span> <span class="kc">True</span><span class="p">))</span>
    <span class="n">predicted_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_pred_threshold</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">actually_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_train</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
    
    <span class="n">precision_val</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="n">predicted_true</span> <span class="k">if</span> <span class="n">predicted_true</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">recall_val</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="n">actually_true</span> <span class="k">if</span> <span class="n">actually_true</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    
    <span class="n">precision</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">precision_val</span><span class="p">)</span>
    <span class="n">recall</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recall_val</span><span class="p">)</span>

<span class="n">precision</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">recall</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Precision-Recall curve&#39;</span><span class="p">)</span>

<span class="c1"># Annotate the points with their corresponding thresholds</span>
<span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span><span class="n">precision</span><span class="p">,</span><span class="n">thresholds</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
        <span class="nb">round</span><span class="p">(</span><span class="n">zi</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>                     <span class="c1"># Annotation text (z value)</span>
        <span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">),</span>              <span class="c1"># Point to annotate</span>
        <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>  <span class="c1"># How to position the text</span>
        <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>         <span class="c1"># Offset: 5 points to the right and 5 points up</span>
        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span>            <span class="c1"># Horizontal alignment of text</span>
    <span class="p">)</span>

<span class="c1"># Add labels, title and grid</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Recall&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Manual Precision-Recall Curve, the threshold level of a given point is labeled&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ML_worksheet2_25_0.png" src="../../_images/ML_worksheet2_25_0.png" />
</div>
</div>
<p>In general, this curve will be sloped downwards <strong>because precision and recall are a tradeoff:</strong></p>
<ul class="simple">
<li><p>As you increase the threshold, you’ll reduce false positives (more precision) because you only predict default for loans you’re very confident will default</p></li>
<li><p>But as you increase the threshold, you’ll predict fewer defaults, meaning you’ll miss some. This will result in lower recall stats.</p></li>
</ul>
<p>The ideal model is the one closest to the upper right corner. (Ouch!)</p>
<p>Here is the one liner to make that graph, it just doesn’t show the threshold values along the chart:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PrecisionRecallDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sklearn.metrics._plot.precision_recall_curve.PrecisionRecallDisplay at 0x2775b26a510&gt;
</pre></div>
</div>
<img alt="../../_images/ML_worksheet2_27_1.png" src="../../_images/ML_worksheet2_27_1.png" />
</div>
</div>
</div>
<div class="section" id="roc-curve-receiver-operating-characteristic">
<h3>ROC curve (“receiver operating characteristic”)<a class="headerlink" href="#roc-curve-receiver-operating-characteristic" title="Permalink to this headline">¶</a></h3>
<p>Again, this diagnostic takes all the predicted probabilities the model produces, and pretends we set a threshold of 0.01, 0.02, … 0.99. For each possible threshold, compute the false positive rate (FPR) and the true positive rate (TPR).</p>
<p>The Y axis is recall for the outcome equal to 1 (charge offs). We want this to equal 1.</p>
<p>The X axis is 1-recall for the outcome equal to 0 (pay backs). We want this to equal 0. By convention, in a ROC curve, 1-recall for outcome 0 is used because this is equal to the false positive rate. False positives are bad!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RocCurveDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;sklearn.metrics._plot.roc_curve.RocCurveDisplay at 0x2775b22c390&gt;
</pre></div>
</div>
<img alt="../../_images/ML_worksheet2_29_1.png" src="../../_images/ML_worksheet2_29_1.png" />
</div>
</div>
<ul class="simple">
<li><p>This curve shows that you can alter the threshold to reduce false positives, but at the cost of missing some true positives.</p></li>
<li><p>The perfect estimator is the upper left corner.</p></li>
<li><p>Different estimators will have differently shaped curves, and the closer it gets to the upper left hand corner, the better.</p></li>
<li><p><strong>“AUC”</strong> reports the area under the curve. 1 is a perfect estimator and 0.5 is a random guess.</p></li>
</ul>
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/13/Roc_curve.svg/768px-Roc_curve.svg.png"  style="width:50%;"> 
</div>
</div>
<div class="section" id="the-problem-with-our-estimator-imbalance">
<h2>The problem with our estimator: Imbalance<a class="headerlink" href="#the-problem-with-our-estimator-imbalance" title="Permalink to this headline">¶</a></h2>
<p>The issue that is causing this problem is something that is rampant in real business settings: <strong>“Imbalanced classes.”</strong></p>
<p>Meaning: We have 85% and 15% for our two classes (paid off and charged off) instead of 50/50.</p>
<p>Imbalance causes problems with many (though not all) ML estimators.</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> treats both outcomes as equally important to predict, which is why it favors the majority class (and always predicts no default).</p>
</div>
<div class="section" id="options-to-deal-with-imbalanced-data">
<h2>Options to deal with imbalanced data<a class="headerlink" href="#options-to-deal-with-imbalanced-data" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Manually pick a different threshold. If the predicted probablity is above X%, predict the outcome is positive. The default is 50%.</p></li>
<li><p>Change estimator to “weight” groups equally</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">class-weight=’balanced’</span></code> in tree models and logit</p></li>
<li><p>Is “like” oversampling, except no slowdown</p></li>
</ul>
</li>
<li><p>Remove data (meaning: undersample overrepresented group)</p>
<ul class="simple">
<li><p>Throws data away (hurts predictions!) but estimations faster</p></li>
<li><p>Tradeoff can be worth it: more speed and possibly similar or better predictions</p></li>
</ul>
</li>
<li><p>Add data (meaning: oversample underrepresented group)</p>
<ul class="simple">
<li><p>Slower estimations (more data)</p></li>
</ul>
</li>
</ol>
<div class="section" id="practical-tips">
<h3>🔥🔥🔥 Practical tips: 🔥🔥🔥<a class="headerlink" href="#practical-tips" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>What works best varies between applications (no “dominant”)</p></li>
<li><p><strong>Try weighting if estimator will let you, then undersampling</strong></p></li>
</ul>
</div>
<div class="section" id="changing-the-threshold-manually">
<h3>Changing the threshold manually<a class="headerlink" href="#changing-the-threshold-manually" title="Permalink to this headline">¶</a></h3>
<p>Let’s change the threshold to 0.15 (the avg probability of default in the sample) and see how that affects the confusion matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred_proba</span> <span class="o">=</span> <span class="n">clf_logit</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># get the predicted probabilities</span>
<span class="n">y_mean</span>       <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="c1"># get the mean of y_train</span>
<span class="n">y_pred</span>       <span class="o">=</span> <span class="p">(</span><span class="n">y_pred_proba</span> <span class="o">&gt;=</span> <span class="n">y_mean</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>     <span class="c1"># convert to binary predictions</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              precision    recall  f1-score   support

       False       0.91      0.57      0.70     91024
        True       0.23      0.69      0.34     16819

    accuracy                           0.59    107843
   macro avg       0.57      0.63      0.52    107843
weighted avg       0.80      0.59      0.65    107843
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="weighting-example">
<h3>Weighting example<a class="headerlink" href="#weighting-example" title="Permalink to this headline">¶</a></h3>
<p>Denying a loan to a good customer is not as bad as giving a loan to a bad customer that defaults. You should probably <em>weigh</em> defaults more heavily.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">LogisticRegression()</span></code> model has a parameter that lets you decide how you weigh the class’s importance. You can manually specific them, but <code class="docutils literal notranslate"><span class="pre">LogisticRegression(class_weight='balanced')</span></code> will cause the minority class to be considered equally important overall. (Maybe you want to weigh even more, which you can do by manually setting the weights.)</p>
<p>So, I’m going to change the pipeline (not the logit) to use that parameter. I just need to find out what the <em>pipeline</em> calls that parameter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># clf_logit.get_params()</span>
<span class="c1"># looking for the name of the parameter, as the pipeline calls it</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_logit</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">logisticregression__class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">)</span>

<span class="n">clf_logit</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> 
                            <span class="n">clf_logit</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              precision    recall  f1-score   support

       False       0.91      0.57      0.70     91024
        True       0.23      0.69      0.34     16819

    accuracy                           0.59    107843
   macro avg       0.57      0.63      0.52    107843
weighted avg       0.80      0.59      0.65    107843
</pre></div>
</div>
</div>
</div>
<p>Hey! We managed to actually predict some defaults! Look:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">clf_logit</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">display_labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Paid Back&quot;</span><span class="p">,</span> <span class="s2">&quot;Default&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Model 2: Logit With Class Weights&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ML_worksheet2_38_0.png" src="../../_images/ML_worksheet2_38_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="recap-before-exercises">
<h2>Recap before exercises:<a class="headerlink" href="#recap-before-exercises" title="Permalink to this headline">¶</a></h2>
<p>We have 5 diagnostics that are useful:</p>
<ol class="simple">
<li><p>Calibration Display: Is your model producing well-tuned probabilities?</p></li>
<li><p>Classification report: How does the classifier do?</p></li>
<li><p>Confusion Matrix: Show the prediction counts</p></li>
<li><p>Precision-Recall Curve: Can your model have high recall and precision if we adjust the threshold?</p></li>
<li><p>ROC Curve: Can your model have low false positives and high recall if we adjust the threshold?</p></li>
</ol>
<p>Classifiers struggle with imbalanced data.</p>
<ul class="simple">
<li><p>We can tell the model to “balance” the classes (balancing their frequency)</p></li>
<li><p>We can pick the threshold</p></li>
</ul>
<p>The exercises force us to think about these models as business applications.</p>
</div>
<div class="section" id="exercises-1-5-this-is-just-business-math">
<h2>Exercises 1-5: This is just business math!<a class="headerlink" href="#exercises-1-5-this-is-just-business-math" title="Permalink to this headline">¶</a></h2>
<p>For these questions, assume your bank uses automated underwriting: If the model says you’ll pay back the loan, they make the loan.</p>
<p>Make extra (reasonable) assumptions as needed to compare the two models:</p>
<ol class="simple">
<li><p>How much money does M2 save us relative to M1 from reduced charge-offs?</p></li>
<li><p>How much foregone profit does M2 have relative to M1?</p></li>
<li><p>Would you rather use M1 or M2 at your bank and why?</p></li>
<li><p>Write down a profit function for firm. Use the cells of the confusion matrix as variables, as needed.</p>
<ul class="simple">
<li><p>The four cells of the matrix are TN (upper left), FP (upper right), TP (lower right), FN (lower left)</p></li>
</ul>
</li>
<li><p>We want to maximize profits, but all the ML diagnostics above are different. Try to rewrite your profit function to include PRECISION OR RECALL.</p>
<ul class="simple">
<li><p>Which do you want to maximize/minimize?</p></li>
<li><p>Are any of them equivalent to maximizing profits?</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># put answers here</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="exercises-6-and-7-now-we-think-about-reflecting-our-biz-logic-in-code">
<h2>Exercises 6 and 7: Now we think about reflecting our biz logic in code<a class="headerlink" href="#exercises-6-and-7-now-we-think-about-reflecting-our-biz-logic-in-code" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Prof demo 1: WAIT! We want to max profits! Why are we talking about evaluating precision and recall? Let’s just eval profits!</p>
<ul class="simple">
<li><p>It turns out that the way we “weigh” the classes in the classifier has a economic intuition.</p></li>
<li><p>In M1, charge offs and pay backs are treated as equally important, and have weight = 1.</p></li>
<li><p>In M2, charge offs are made to be equally important in terms of <strong>frequency</strong>.</p></li>
<li><p>The classifier “upweighs” charge offs to have a weight of 5.7 (0.85/0.15).</p></li>
<li><p>Let’s introduce a third model (M3): Charge offs should be equally important in terms of <strong>economic cost</strong>.</p></li>
</ul>
</li>
<li><p>Prof demo 2: Can we just… directly optimize the threshold?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># put answers here</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="bonus-demo-undersampling">
<h2>Bonus demo: Undersampling<a class="headerlink" href="#bonus-demo-undersampling" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># !pip install -U imbalanced-learn</span>

<span class="c1"># from imblearn.pipeline import make_pipeline as make_pipeline_with_sampler</span>
<span class="c1"># from imblearn.under_sampling import RandomUnderSampler</span>

<span class="c1"># logit_undersamp = make_pipeline_with_sampler(</span>
<span class="c1">#     preproc_pipe,</span>
<span class="c1">#     RandomUnderSampler(random_state=42),</span>
<span class="c1">#     LogisticRegression(),</span>
<span class="c1"># )</span>

<span class="c1"># logit_undersamp.fit(X_train, y_train) </span>

<span class="c1"># y_pred = logit_undersamp.predict(X_train,)</span>
<span class="c1"># print(classification_report(y_train, y_pred))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./handouts/ML"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Prof. Donald Bowen<br/>
        
            &copy; Copyright 2025.<br/>
          <div class="extra_footer">
            You're doing well, keep going!
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>